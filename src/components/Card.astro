---
import { Image } from 'astro:assets';
import { inlineMarkdownStrip } from '../utils/markdown.ts';

interface Props {
	itemtype: string;
	url?: string;
	draft?: boolean;
	class?: string;
	image?: ImageMetadata;
	imageAlt?: string;
	themeImages?: Record<string, ImageMetadata>;
}

const { itemtype, url, draft, class: cardClass, image, imageAlt, themeImages } = Astro.props;
---
<m-card>
	<article class={`card ${cardClass ?? ''}`} itemscope {itemtype}>
		<div hidden class="card-meta">
			<meta itemprop="url" content={url} />
			<slot name="metadata"></slot>
		</div>

		<picture itemprop="image" itemscope itemtype="https://schema.org/ImageObject">
			{
				image && (
					<Fragment>
						<Image
							itemprop="contentUrl"
							src={image}
							alt={inlineMarkdownStrip(imageAlt ?? '')}
							loading="lazy"
							widths={[64, 128, 256, 512]}
							width={256}
							sizes={`(max-width: 360px) 128px, (max-width: 720px) 256px, (max-width: 1280px) 512px, (max-width: 2160px) 768px ${image.width}px`}
							quality={75}
						/>
						{
							Object.entries(themeImages ?? {}).map(([theme, themeImage]) => (
								<Image
									itemprop="contentUrl"
									data-theme-image={theme}
									src={themeImage}
									alt={inlineMarkdownStrip(imageAlt ?? '')}
									loading="lazy"
									widths={[64, 128, 256, 512]}
									width={256}
									sizes="(max-width: 360px) 64px, (max-width: 720px) 128px, (max-width: 1280px) 256px, 512px"
									quality={75}
									hidden
								/>
							))
						}
					</Fragment>
				)
			}
		</picture>

		<header>
			<div class="card-title">
				{draft && <span class="draft-tag">Draft</span>}
				<a href={url ?? null} itemprop="name">
					<slot name="title"></slot>
				</a>
			</div>

			<aside class="card-subtitle">
				<slot name="subtitle"></slot>
			</aside>
		</header>

		<div class="card-content" itemprop="description">
			<slot></slot>
		</div>

		<aside class="card-links">
			<slot name="links"></slot>
		</aside>

		<footer>
			<slot name="footer"></slot>
		</footer>
	</article>
</m-card>
