---
import '../assets/css/pages/resume.css';
import { Icon } from 'astro-icon/components';
import type { Icon as IconName } from 'virtual:astro-icon';
import resume from '../../public/assets/documents/resume.json' with { type: 'json' };
import HtmlHead from '../components/HtmlHead.astro';

const formatter = new Intl.DateTimeFormat('en-CA', { month: 'long', year: 'numeric' });
const langNameFormatter = new Intl.DisplayNames('en-CA', { type: 'language' });
const collator = new Intl.Collator('en', { usage: 'sort' });
const projectsMap: Record<string, IconName> = {
	application: 'mingcute:code-line',
	talk: 'mingcute:drawing-board-line'
};
const linksMap: Record<string, IconName> = {
	GitHub: 'mingcute:github-line',
	CodePen: 'mingcute:codepen-line',
	LinkedIn: 'mingcute:linkedin-line'
};

function dateSorter(
	{ startDate: startA, endDate: endA }: { startDate: string, endDate?: string },
	{ startDate: startB, endDate: endB }: { startDate: string, endDate?: string }
) {
	if (!endA && !endB) {
		return 0;
	} else if (!endA) {
		return -1;
	} else if (!endB) {
		return 1;
	}

	const endDateA = new Date(endA);
	const endDateB = new Date(endB);
	const startDateA = new Date(startA);
	const startDateB = new Date(startB);

	return endDateB.getTime() - endDateA.getTime() || startDateB.getTime() - startDateA.getTime();
}
---
<!DOCTYPE html>
<html lang="en-US" itemscope itemtype="https://schema.org/WebPage">
	<HtmlHead
		title="Resume | Marco Campos"
		description="Resume"
	/>
	<body
		class="h-resume"
		itemprop="about"
		itemscope
		itemprop="https://schema.org/Person"
	>
		<header>
			<hgroup>
				<h1 class="p-name" itemprop="name">{resume.basics.name}</h1>
				<p class="p-job-title" itemprop="jobTitle">{resume.basics.label}</p>
			</hgroup>

			<details>
				<summary>Alternative File Formats</summary>

				<ul>
					<li><a href="/assets/documents/resume.pdf" download><abbr title="Portable Document File">PDF</abbr></a></li>
					<li><a href="/assets/documents/resume.json" download><abbr title="JavaScript Object Notation">JSON</abbr></a></li>
				</ul>
			</details>

			<aside class="p-contact h-card">
				<ul id="links">
					<li>
						<Icon name="mingcute:mail-line" aria-hidden="true" />
						<a
							href={`mailto:${resume.basics.email}`}
							target="_blank"
							rel="noopener noreferrer me"
							referrerpolicy="no-referrer"
							itemprop="email"
							class="u-email"
						>{resume.basics.email}</a>
					</li>
					<!-- INFO: phone not added for privacy reasons -->
					<!--
						<li>
							<Icon name="mingcute:phone-line" aria-hidden="true" />
							<a
								href={`tel:${resume.basics.phone}`}
								target="_blank"
								rel="noopener noreferrer"
								referrerpolicy="no-referrer"
								itemprop="telephone"
								class="p-tel"
							>{resume.basics.phone}</a>
						</li>
					-->
					<li>
						<Icon name="mingcute:link-line" aria-hidden="true" />
						<a
							href={resume.basics.url}
							rel="me"
							itemprop="url"
							class="u-url"
						>{resume.basics.url}</a>
					</li>
					{
						resume.basics.profiles.map(({ network, url, username }) => (
							<li itemprop="contactPoint" itemscope itemtype="https://schema.org/ContactPoint">
								<Icon name={linksMap[network] ?? 'mingcute:link-line'} aria-hidden="true" />
								<meta itemprop="contactType" content={network} />
								<meta itemprop="identifier" content={username} />
								<a
									href={url}
									target="_blank"
									rel="noopener noreferrer me"
									referrerpolicy="no-referrer"
									class="u-url"
									itemprop="url"
								>{network}</a>
							</li>
						))
					}
				</ul>
			</aside>

			<blockquote class="p-summary">{resume.basics.summary}</blockquote>
		</header>

		<hr />

		<main>
			<section>
				<h2>Skills & Languages</h2>

				<ul id="skill-list">
					{
						resume.skills
							.toSorted(({ name: nameA }, { name: nameB }) => collator.compare(nameA, nameB))
							.map(({ name, level }) => (
							<li>
								<span class="p-skill" itemprop="knowsAbout">{name}</span>
								<span>({level})</span>
							</li>
						))
					}
					{
						resume.languages
							.map(({ language, fluency }) => (
							<li
								itemprop="knowsLanguage"
								itemscope
								itemtype="https://schema.org/Language"
							>
								<meta itemprop="name" content={language} />
								<span class="p-skill" itemprop="alternateName">{langNameFormatter.of(language)}</span>
								<span>({fluency})</span>
							</li>
						))
					}
				</ul>

				<hr />
			</section>

			<section id="experience">
				<h2>Experience</h2>

				<dl>
					{
						resume.work.toSorted(dateSorter).map((
							{ name, position, description, highlights, location, startDate, endDate, summary }
						) => (
							<div
								class="h-event"
								itemprop="hasOccupation"
								itemscope
								itemtype="https://schema.org/Role"
							>
								<dt>
									<entry-title class="p-name" itemprop="name">{position}</entry-title>
									<entry-subtitle
										class="h-card"
										itemprop="owner"
										itemscope
										itemtype="https://schema.org/Organization"
									>
										<span class="p-name" itemprop="name">{name}</span>
										<small class="p-description" itemprop="description">{description}</small>
									</entry-subtitle>
									<entry-date>
										<time
											datetime={new Date(startDate).toISOString()}
											class="dt-start"
											itemprop="startDate"
										>{formatter.format(new Date(startDate))}</time>
										<span>&mdash;</span>
										{
											endDate
												? (
												<time
													data-enddate
													datetime={new Date(endDate).toISOString()}
													class="dt-end"
													itemprop="endDate"
												>{formatter.format(new Date(endDate))}</time>
											)
											: <span>Present</span>
										}
									</entry-date>
									<entry-location>
										<address class="p-location">{location}</address>
									</entry-location>
								</dt>
								<dd class="p-summary" itemprop="description">
									<p>{summary}</p>

									<ul>
										{highlights.map((highlight) => <li>{highlight}</li>)}
									</ul>
								</dd>
							</div>
						))
					}
				</dl>

				<hr />
			</section>

			<section>
				<h2>Volunteering</h2>
				<dl>
					{
						resume.volunteer.toSorted(dateSorter).map((
							{ position, highlights, startDate, endDate, summary, organization, url }
						) => (
							<div
								class="h-event"
								itemprop="hasOccupation"
								itemscope
								itemtype="https://schema.org/Role"
							>
								<dt>
									<entry-title class="p-name" itemprop="name">{position}</entry-title>
									<entry-subtitle
										class="h-card"
										itemprop="owner"
										itemscope
										itemtype="https://schema.org/Organization"
									>
										<meta class="p-name" itemprop="name" content={organization} />
										<a
											href={url}
											target="_blank"
											rel="noopener noreferrer"
											referrerpolicy="no-referrer"
											itemprop="sameAs"
										>{organization}</a>
									</entry-subtitle>
									<entry-date>
										<time
											datetime={new Date(startDate).toISOString()}
											class="dt-start"
											itemprop="startDate"
										>{formatter.format(new Date(startDate))}</time>
										<span>&mdash;</span>
										{
											endDate
												? (
												<time
													data-enddate
													datetime={new Date(endDate).toISOString()}
													class="dt-end"
													itemprop="endDate"
												>{formatter.format(new Date(endDate))}</time>
											)
											: <span>Present</span>
										}
									</entry-date>
								</dt>
								<dd class="p-summary" itemprop="description">
									<p>{summary}</p>

									<ul>
										{highlights.map((highlight) => <li>{highlight}</li>)}
									</ul>
								</dd>
							</div>
						))
					}
				</dl>

				<hr />
			</section>

			<section>
				<h2>Education</h2>

				<dl>
					{
						resume.education.toSorted(dateSorter).map((
							{ startDate, endDate, url, institution, area, studyType, highlights }
						) => (
							<div
								class="h-event"
								itemprop="hasCredential"
								itemscope
								itemtype="https://schema.org/EducationalOccupationalCredential"
							>
								<dt>
									<entry-title class="p-name" itemprop="educationalLevel">{studyType} {area}</entry-title>
									<entry-subtitle
										class="h-card"
										itemprop="recognizedBy"
										itemscope
										itemtype="https://schema.org/Organization"
									>
										<meta class="p-name" itemprop="name" content={institution} />
										<a
											href={url}
											target="_blank"
											rel="noopener noreferrer"
											referrerpolicy="no-referrer"
											itemprop="sameAs"
										>{institution}</a>
									</entry-subtitle>
									<entry-date>
										<meta itemprop="temporalCoverage" content={`${startDate} — ${endDate ?? 'Present'}`} />
										<time datetime={new Date(startDate).toISOString()}>{formatter.format(new Date(startDate))}</time>
										<span>&mdash;</span>
										{
											endDate
												? <time datetime={new Date(endDate).toISOString()}>{formatter.format(new Date(endDate))}</time>
											: <span>Present</span>
										}
									</entry-date>
								</dt>
								<dd class="p-summary" itemprop="description">
									<ul>
										{highlights.map((highlight) => <li>{highlight}</li>)}
									</ul>
								</dd>
							</div>
						))
					}
				</dl>

				<hr />
			</section>

			<section id="projects">
				<h2>Projects & Talks</h2>

				<dl>
					{
						resume.projects.toSorted(dateSorter).map((
							{ startDate, endDate, url, description, entity, name, type }
						) => (
							<div
								class="h-card"
								itemprop={type === 'talk' ? 'performerIn' : 'subjectOf'}
								itemscope
								itemtype={`https://schema.org/${type === 'talk' ? 'Event' : 'CreativeWork'}`}
							>
								<dt>
									<Icon name={projectsMap[type] ?? 'mingcute:test-tube-line'} aria-hidden="true" />
									<entry-title itemprop="name">{name}</entry-title>
									<entry-subtitle
										class="h-card"
										itemprop={type === 'talk' ? 'organizer' : 'publisher'}
										itemscope
										itemtype="https://schema.org/Organization"
									>
										<meta class="p-name" itemprop="name" content={entity} />
										<a
											href={url}
											target="_blank"
											rel="noopener noreferrer"
											referrerpolicy="no-referrer"
											itemprop="sameAs"
										>{entity}</a>
									</entry-subtitle>
									<entry-date>
										{
											type !== 'talk' && (
												<meta
													itemprop="temporalCoverage"
													content={`${startDate} — ${endDate ?? 'Present'}`}
												/>
											)
										}
										<time
											datetime={new Date(startDate).toISOString()}
											class="dt-start"
											itemprop={type === 'talk' ? 'startDate' : null}
										>{formatter.format(new Date(startDate))}</time>
										<span>&mdash;</span>
										{
											endDate
												? (
												<time
													data-enddate
													datetime={new Date(endDate).toISOString()}
													class="dt-end"
													itemprop={type === 'talk' ? 'endDate' : null}
												>{formatter.format(new Date(endDate))}</time>
											)
											: <span>Present</span>
										}
									</entry-date>
								</dt>
								<dd class="p-summary" itemprop="description">
									<p>{description}</p>
								</dd>
							</div>
						))
					}
				</dl>

				<hr />
			</section>

			<section id="awards">
				<h2>Publications & Awards</h2>

				<ul>
					{
						resume.awards.map((
							{ date, awarder, title }
						) => (
							<li>
								<Icon name="mingcute:medal-line" aria-hidden="true" />
								<entry-title>
									<cite itemprop="award">{title}</cite>
								</entry-title>
								<entry-subtitle>
									<span>{awarder}</span>
								</entry-subtitle>
								<entry-date>
									<time data-enddate datetime={new Date(date).toISOString()}>{formatter.format(new Date(date))}</time>
								</entry-date>
							</li>
						))
					}
					{
						resume.publications.map((
							{ name, publisher, releaseDate }
						) => (
							<li itemprop="subjectOf" itemscope itemtype="https://schema.org/ScholarlyArticle">
								<Icon name="mingcute:document-3-line" aria-hidden="true" />
								<entry-title>
									<cite itemprop="name">{name}</cite>
								</entry-title>
								<entry-subtitle itemprop="publisher" itemscope itemtype="https://schema.org/Organization">
									<span itemprop="name">{publisher}</span>
								</entry-subtitle>
								<entry-date>
									<time
										data-enddate
										datetime={new Date(releaseDate).toISOString()}
										itemprop="datePublished"
									>{formatter.format(new Date(releaseDate))}</time>
								</entry-date>
							</li>
						))
					}
				</ul>

				<hr />
			</section>

			<section>
				<h2>Interests</h2>

				<ul>
					{
						resume.interests.map((
							{ name }
						) => (
							<li>
								<span itemprop="knowsAbout">{name}</span>
							</li>
						))
					}
				</ul>
			</section>
		</main>
		<script src="../assets/js/pages/resume.ts"></script>
	</body>
</html>
