---
import type { GetStaticPaths, InferGetStaticPropsType, PaginateFunction } from 'astro';
import BlogPosts from '../../../components/BlogPosts.astro';
import { listPostPagesByYear, MAX_POSTS_PER_PAGE } from '../../../utils/post.js';

// eslint-disable-next-line @typescript-eslint/no-use-before-define
type Props = InferGetStaticPropsType<typeof getStaticPaths>;

export const getStaticPaths = (async ({ paginate }: { paginate: PaginateFunction }) => {
	const postsList = await listPostPagesByYear();

	return [...postsList.entries()].flatMap(([yearKey, yearPosts]) =>
		paginate(yearPosts, {
			params: {
				year: yearKey
			},
			pageSize: MAX_POSTS_PER_PAGE
		})
	);
}) satisfies GetStaticPaths;

const {
	data: posts,
	currentPage,
	lastPage,
	start,
	end,
	total,
	size
} = Astro.props.page;
const { year } = Astro.params;
---
<BlogPosts
	title={`Posts from: "${year}"`}
	baseUrl={`/blog/${year}/`}
	{posts}
	{currentPage}
	{lastPage}
	{start}
	{end}
	{total}
	{size}
/>
