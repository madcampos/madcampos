---
import '../../assets/css/pages/projects.css';
import { Icon } from 'astro-icon/components';
import Card from '../../components/Card/Card.astro';
import CSSNakedDay from '../../components/CSSNakedDay/CSSNakedDay.astro';
import Effects from '../../components/Effects/Effects.astro';
import HtmlHead from '../../components/HtmlHead/HtmlHead.astro';
import IabEscape from '../../components/IabEscape/IabEscape.astro';
import Logo from '../../components/Logo/Logo.astro';
import OldStyleButtons from '../../components/OldStyleButtons/OldStyleButtons.astro';
import SiteNav from '../../components/SiteNav/SiteNav.astro';
import SkipToContent from '../../components/SkipToContent/SkipToContent.astro';
import Webrings from '../../components/Webrings/Webrings.astro';
import { listAllProjects } from '../../utils/projects.js';

const projects = await Promise.all((await listAllProjects()).map(async (project) => {
	const { Content } = await project.render();

	return {
		data: project.data,
		Content
	};
}));

const formatter = new Intl.DateTimeFormat('en-US', { dateStyle: 'long' });
---
<!DOCTYPE html>
<html lang="en-US" itemscope itemtype="https://schema.org/ItemList">
	<HtmlHead
		title="Project Highlight | Marco Campos"
		description="A list of projects I've worked on, or am currently working on. Mostly web development"
		url={Astro.url.href}
	/>
	<body>
		<CSSNakedDay />
		<main>
			<header id="page-header">
				<SkipToContent />
				<SiteNav />
				<div>
					<Logo
						subtitle="Projects"
						shortSubtitle="Proj."
						url="/projects/"
						title="Projects Page"
					/>
					<h1>Project Highlight</h1>
				</div>
			</header>

			{
				projects.map(({ Content, data }) => (
					<Card
						class="project-card"
						url={data.url}
						draft={data.draft}
						itemtype="http://schema.org/WebApplication"
						image={data.image}
						imageAlt={data.imageAlt ?? ''}
						themeImages={data.themeImages}
					>
						<Fragment slot="meta">
							<meta itemprop="operatingSystem" content="https://schema.org/AllOperatingSystem" />
							<meta itemprop="browserRequirements" content="https://schema.org/GenericWebPlatform" />
							<meta itemprop="applicationCategory" content="BrowserApplication" />
							<div itemprop="offers" itemscope itemtype="https://schema.org/Offer" hidden>
								<meta itemprop="availability" content="https://schema.org/InStock" />
								<meta itemprop="price" content="0" />
								<meta itemprop="priceCurrency" content="USD" />
							</div>
							<meta itemprop="isAccessibleForFree" content="True" />
						</Fragment>
						<h2 slot="title">
							<Fragment set:html={data.title} />
						</h2>

						<Fragment slot="subtitle">
							<span class="project-status" data-status={data.status}>
								<Icon name={data.status === 'ongoing' ? 'uil:history' : 'uil:check-circle'} title="Project status" /> {
									data.status === 'ongoing' ? 'Ongoing' : 'Finished'
								}
							</span>
							<span>
								<Icon name="uil:calendar-alt" title="Date started" />
								<time datetime={data.createdAt.toISOString()} itemprop="dateCreated">{formatter.format(data.createdAt)}</time>
								{
									data.updatedAt && (
										<span>&mdash; <time datetime={data.updatedAt.toISOString()} itemprop="dateModified">{formatter.format(data.updatedAt)}</time></span>
									)
								}
							</span>
							<span itemprop="softwareVersion">
								<Icon name="uil:box" title="Current version" /> {data.version}
							</span>
						</Fragment>

						<Content />

						<Fragment slot="links">
							{
								data.url && (
									<a href={data.url} rel="noopener noreferrer" referrerpolicy="no-referrer" itemprop="installUrl">
										<Icon name="uil:link" title="" role="presentation" />
										View Project
									</a>
								)
							}
							&nbsp;
							{
								data.repository && (
									<a href={data.repository} rel="noopener noreferrer" referrerpolicy="no-referrer">
										<Icon name="uil:github" title="" role="presentation" />
										View Repository
									</a>
								)
							}
						</Fragment>

						<details slot="footer">
							<summary>
								<span>
									<Icon name="uil:cog" title="" role="presentation" />
									Technologies used
								</span>
							</summary>
							<ul class="technology-tags">
								{data.techStack?.map((tech) => <li class="tag">{tech}</li>)}
							</ul>
						</details>
					</Card>
				))
			}
		</main>

		<footer id="page-footer">
			<OldStyleButtons />
			<Webrings />
		</footer>
		<Effects />
		<IabEscape />
	</body>
</html>
